name: Deploy
on:
  push:
    branches: fix/env-variables-expose
  pull_request:
    branches: fix/env-variables-expose

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest

    permissions:
      id-token: write # Needed for auth with Deno Deploy
      contents: read # Needed to clone the repository

    steps:
      - name: Clone repository
        uses: actions/checkout@v4

      - name: Install Deno
        uses: denoland/setup-deno@v2
        with:
          deno-version: v2.x

      - name: Install Node.js
        uses: actions/setup-node@v4
        with:
          node-version: lts/*

      - name: Install step
        run: "npm install"

      - name: Create .env file
        run: |
         echo "PUBLIC_MODE=DEV" > .env
         echo "PUBLIC_BASE_URL=https://devapi.credebl.id" >> .env
         echo "PUBLIC_SHOW_NAME_AS_LOGO=true" >> .env
         echo "PUBLIC_PLATFORM_NAME=CREDEBL" >> .env
         echo "PUBLIC_PLATFORM_LOGO=/images/CREDEBL_ICON.png" >> .env
         echo "PUBLIC_POWERED_BY=Blockster Labs Pvt. Ltd" >> .env
         echo "PUBLIC_PLATFORM_DOCS_URL=https://docs.credebl.id/en/intro/what-is-credebl/" >> .env
         echo "PUBLIC_PLATFORM_GIT=https://github.com/credebl" >> .env
         echo "PUBLIC_PLATFORM_TWITTER_URL=https://twitter.com/i/flow/login?redirect_after_login=%2Fcredebl" >> .env
         echo "PUBLIC_PLATFROM_DISCORD_SUPPORT=https://discord.gg/w4hnQT7NJG" >> .env
         echo "PUBLIC_ALLOW_DOMAIN=${{ secrets.DEV_PUBLIC_ALLOW_DOMAIN }}" >> .env
         echo "PUBLIC_POLYGON_MAINNET_URL=https://polygon-rpc.com/" >> .env
         echo "PUBLIC_POLYGON_TESTNET_URL=https://rpc-amoy.polygon.technology" >> .env
         echo "PUBLIC_ECOSYSTEM_FRONT_END_URL=https://dev-ecosystem.credebl.id" >> .env
         echo "PUBLIC_ECOSYSTEM_BASE_URL=https://devecosystem-api.credebl.id" >> .env
         echo "PUBLIC_PLATFORM_DISCORD_URL=https://discord.gg/w4hnQT7NJG" >> .env
         echo "PUBLIC_REDIRECTION_TARGET_URL=https://social-share.credebl.id" >> .env
         echo "PUBLIC_CRYPTO_PRIVATE_KEY=${{ secrets.DEV_PUBLIC_CRYPTO_PRIVATE_KEY }}" >> .env
         echo "PUBLIC_KEYCLOAK_MANAGEMENT_CLIENT_ID=${{ secrets.DEV_PUBLIC_KEYCLOAK_MANAGEMENT_CLIENT_ID }}" >> .env
         echo "PUBLIC_KEYCLOAK_MANAGEMENT_CLIENT_SECRET=${{ secrets.DEV_PUBLIC_KEYCLOAK_MANAGEMENT_CLIENT_SECRET }}" >> .env
         echo "PUBLIC_REDIRECT_FROM_URL=https://dev.credebl.id" >> .env

      - name: Build step
        run: "npm run build"

      - name: Upload to Deno Deploy
        uses: denoland/deployctl@v1
        with:
          project: "credebl-dev-ui"
          entrypoint: "server/entry.mjs"
          root: "dist"
          
          
